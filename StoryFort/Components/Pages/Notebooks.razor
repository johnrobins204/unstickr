    <!-- Watermark -->
    <div class="absolute bottom-10 right-10 pointer-events-none opacity-10 select-none z-0">
        <div class="text-8xl">ðŸ“š</div>
    </div>
@page "/notebooks"
@using StoryFort.Models
@using StoryFort.Services
@using StoryFort.Data
@using StoryFort.Components.EditorPanels
@using Microsoft.EntityFrameworkCore
@inject AppDbContext DbContext
@inject StoryState StoryState

<PageTitle>StoryFort - Notebooks</PageTitle>

<div class="flex flex-col gap-6 w-full max-w-6xl mx-auto">
    <div class="flex items-center justify-between border-b-4 border-[var(--border)] bg-[var(--card)] px-6 py-4">
        <h3 class="text-lg font-bold text-[var(--primary)] flex items-center gap-2" style="font-family: var(--heading-font)"><i data-lucide="book" class="size-5"></i> Story Notebooks</h3>
        <p class="text-xs text-[var(--muted-foreground)]">Your collection of world knowledge.</p>
    </div>
    <div class="flex-1 p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-8">
            @foreach (var nb in StoryState.Notebooks)
            {
                <div class="pixel-card p-6 cursor-pointer hover:border-[var(--primary)] transition-all group" style="border-radius: var(--radius)">
                    <div class="mb-4">
                        <div class="text-5xl mb-3">ðŸ“š</div>
                        <h3 class="text-sm font-bold text-[var(--foreground)] mb-2 leading-relaxed" style="font-family: var(--heading-font)">@nb.Name</h3>
                        @if (nb.IsSystem)
                        {
                            <span class="text-[8px] bg-[var(--secondary)] text-white px-1 py-0.5 font-bold uppercase" style="border-radius: var(--radius)">System Repo</span>
                        }
                    </div>
                    <div class="space-y-2 text-xs text-[var(--muted-foreground)]">
                        <div class="flex items-center gap-2"><i data-lucide="book" class="size-3"></i><span>@(nb.Entities?.Count ?? 0) entries</span></div>
                        <div class="flex items-center gap-2"><i data-lucide="calendar" class="size-3"></i><span>@nb.LastModified.ToShortDateString()</span></div>
                    </div>
                    <div class="mt-4 pt-4 border-t-2 border-[var(--border)] opacity-0 group-hover:opacity-100 transition-opacity">
                        <button class="text-xs text-[var(--primary)] font-bold">OPEN â†’</button>
                    </div>
                </div>
            }
            <div class="bg-[var(--muted)] border-4 border-dashed border-[var(--border)] p-6 flex flex-col items-center justify-center min-h-[200px] hover:bg-opacity-60 cursor-pointer transition-colors" style="border-radius: var(--radius)">
                <i data-lucide="plus" class="size-8 text-[var(--muted-foreground)] mb-3"></i>
                <p class="text-xs text-[var(--muted-foreground)] text-center font-bold">Create Repository</p>
            </div>
        </div>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        // Load global notebooks for Account 1
        // In a real multi-user app, we'd get the actual user ID
        int accountId = 1;
        
        var notebooks = await DbContext.Notebooks
            .Where(n => n.AccountId == accountId)
            .Include(n => n.Entities)
                .ThenInclude(e => e.Entries)
                    .ThenInclude(entry => entry.Story)
            .ToListAsync();
            
        StoryState.Notebooks = notebooks;
        
        // Clear linkage (since we are not in a story)
        StoryState.LinkedEntityIds.Clear();
    }
}

